<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Survey Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .rating-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .rating-btn {
            flex: 1;
            min-width: 40px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .rating-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .rating-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .staff-group {
            display: flex;
            gap: 10px;
        }
        
        .staff-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        .staff-btn:hover {
            border-color: #667eea;
        }
        
        .staff-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        button[type="submit"] {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        button[type="submit"]:hover {
            transform: translateY(-2px);
        }
        
        button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .config-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .config-box code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Form Kh·∫£o S√°t B·ªánh Nh√¢n</h1>
        <p class="subtitle">Test Survey Submission</p>
        
        <div class="config-box">
            <strong>Backend URL:</strong> <code id="backend-url">http://localhost:5000</code><br>
            <small>Thay ƒë·ªïi trong script n·∫øu c·∫ßn</small>
        </div>
        
        <form id="surveyForm">
            <!-- Th√¥ng tin c∆° b·∫£n -->
            <div class="form-group">
                <label for="booking_id">M√£ l·ªãch h·∫πn *</label>
                <input type="text" id="booking_id" name="booking_id" required placeholder="V√≠ d·ª•: BK123456">
            </div>
            
            <div class="form-group">
                <label for="patient_name">H·ªç t√™n b·ªánh nh√¢n *</label>
                <input type="text" id="patient_name" name="patient_name" required placeholder="Nguy·ªÖn VƒÉn A">
            </div>
            
            <div class="form-group">
                <label for="phone">S·ªë ƒëi·ªán tho·∫°i *</label>
                <input type="tel" id="phone" name="phone" required placeholder="0901234567">
            </div>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="email@example.com">
            </div>
            
            <div class="form-group">
                <label for="doctor_name">T√™n b√°c sƒ©</label>
                <input type="text" id="doctor_name" name="doctor_name" placeholder="B√°c sƒ© Nguy·ªÖn VƒÉn A">
            </div>
            
            <!-- ƒê√°nh gi√° NPS (0-10) -->
            <div class="form-group">
                <label>B·∫°n c√≥ gi·ªõi thi·ªáu d·ªãch v·ª• cho ng∆∞·ªùi th√¢n? (NPS: 0-10) *</label>
                <div class="rating-group" id="nps-group">
                    <button type="button" class="rating-btn" data-rating="0">0</button>
                    <button type="button" class="rating-btn" data-rating="1">1</button>
                    <button type="button" class="rating-btn" data-rating="2">2</button>
                    <button type="button" class="rating-btn" data-rating="3">3</button>
                    <button type="button" class="rating-btn" data-rating="4">4</button>
                    <button type="button" class="rating-btn" data-rating="5">5</button>
                    <button type="button" class="rating-btn" data-rating="6">6</button>
                    <button type="button" class="rating-btn" data-rating="7">7</button>
                    <button type="button" class="rating-btn" data-rating="8">8</button>
                    <button type="button" class="rating-btn" data-rating="9">9</button>
                    <button type="button" class="rating-btn" data-rating="10">10</button>
                </div>
                <input type="hidden" id="nps" name="nps" required>
            </div>
            
            <!-- ƒê√°nh gi√° CSAT (0-5) -->
            <div class="form-group">
                <label>M·ª©c ƒë·ªô h√†i l√≤ng (CSAT: 0-5) *</label>
                <div class="rating-group" id="csat-group">
                    <button type="button" class="rating-btn" data-rating="0">0‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="1">1‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="2">2‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="3">3‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="4">4‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="5">5‚≠ê</button>
                </div>
                <input type="hidden" id="csat" name="csat" required>
            </div>
            
            <!-- ƒê√°nh gi√° c∆° s·ªü v·∫≠t ch·∫•t (0-5) -->
            <div class="form-group">
                <label>C∆° s·ªü v·∫≠t ch·∫•t (0-5) *</label>
                <div class="rating-group" id="facility-group">
                    <button type="button" class="rating-btn" data-rating="0">0‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="1">1‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="2">2‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="3">3‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="4">4‚≠ê</button>
                    <button type="button" class="rating-btn" data-rating="5">5‚≠ê</button>
                </div>
                <input type="hidden" id="facility" name="facility" required>
            </div>
            
            <!-- Th√°i ƒë·ªô nh√¢n vi√™n -->
            <div class="form-group">
                <label>Th√°i ƒë·ªô b√°c sƒ©</label>
                <div class="staff-group" id="staff-doctor-group">
                    <button type="button" class="staff-btn" data-value="R·∫•t t·ªët">R·∫•t t·ªët</button>
                    <button type="button" class="staff-btn" data-value="T·ªët">T·ªët</button>
                    <button type="button" class="staff-btn" data-value="Trung b√¨nh">Trung b√¨nh</button>
                    <button type="button" class="staff-btn" data-value="K√©m">K√©m</button>
                </div>
                <input type="hidden" id="staff_doctor" name="staff_doctor">
            </div>
            
            <div class="form-group">
                <label>Th√°i ƒë·ªô y t√°</label>
                <div class="staff-group" id="staff-nurse-group">
                    <button type="button" class="staff-btn" data-value="R·∫•t t·ªët">R·∫•t t·ªët</button>
                    <button type="button" class="staff-btn" data-value="T·ªët">T·ªët</button>
                    <button type="button" class="staff-btn" data-value="Trung b√¨nh">Trung b√¨nh</button>
                    <button type="button" class="staff-btn" data-value="K√©m">K√©m</button>
                </div>
                <input type="hidden" id="staff_nurse" name="staff_nurse">
            </div>
            
            <div class="form-group">
                <label>Th√°i ƒë·ªô l·ªÖ t√¢n</label>
                <div class="staff-group" id="staff-reception-group">
                    <button type="button" class="staff-btn" data-value="R·∫•t t·ªët">R·∫•t t·ªët</button>
                    <button type="button" class="staff-btn" data-value="T·ªët">T·ªët</button>
                    <button type="button" class="staff-btn" data-value="Trung b√¨nh">Trung b√¨nh</button>
                    <button type="button" class="staff-btn" data-value="K√©m">K√©m</button>
                </div>
                <input type="hidden" id="staff_reception" name="staff_reception">
            </div>
            
            <!-- Th·ªùi gian ch·ªù -->
            <div class="form-group">
                <label for="waiting_time">Th·ªùi gian ch·ªù</label>
                <select id="waiting_time" name="waiting_time">
                    <option value="">-- Ch·ªçn --</option>
                    <option value="< 15 ph√∫t">< 15 ph√∫t</option>
                    <option value="15-30 ph√∫t">15-30 ph√∫t</option>
                    <option value="30-60 ph√∫t">30-60 ph√∫t</option>
                    <option value="> 60 ph√∫t">> 60 ph√∫t</option>
                </select>
            </div>
            
            <!-- G√≥p √Ω -->
            <div class="form-group">
                <label for="comment">G√≥p √Ω th√™m</label>
                <textarea id="comment" name="comment" rows="4" placeholder="Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n..."></textarea>
            </div>
            
            <button type="submit" id="submitBtn">G·ª≠i kh·∫£o s√°t</button>
        </form>
        
        <div class="result" id="result"></div>
    </div>

    <script>
        // Configuration
        const BACKEND_URL = 'http://localhost:5000';
        document.getElementById('backend-url').textContent = BACKEND_URL;
        
        // Rating buttons handler
        function setupRatingGroup(groupId, hiddenInputId) {
            const group = document.getElementById(groupId);
            const hiddenInput = document.getElementById(hiddenInputId);
            
            group.querySelectorAll('.rating-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    group.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    hiddenInput.value = btn.dataset.rating;
                });
            });
        }
        
        // Staff buttons handler
        function setupStaffGroup(groupId, hiddenInputId) {
            const group = document.getElementById(groupId);
            const hiddenInput = document.getElementById(hiddenInputId);
            
            group.querySelectorAll('.staff-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    group.querySelectorAll('.staff-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    hiddenInput.value = btn.dataset.value;
                });
            });
        }
        
        // Setup all rating groups
        setupRatingGroup('nps-group', 'nps');
        setupRatingGroup('csat-group', 'csat');
        setupRatingGroup('facility-group', 'facility');
        setupStaffGroup('staff-doctor-group', 'staff_doctor');
        setupStaffGroup('staff-nurse-group', 'staff_nurse');
        setupStaffGroup('staff-reception-group', 'staff_reception');
        
        // Form submission
        document.getElementById('surveyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submitBtn');
            
            // Get form data
            const formData = new FormData(e.target);
            const data = {
                booking_id: formData.get('booking_id'),
                patient_name: formData.get('patient_name'),
                phone: formData.get('phone'),
                email: formData.get('email') || null,
                doctor_name: formData.get('doctor_name') || null,
                nps: parseInt(formData.get('nps')),
                csat: parseInt(formData.get('csat')),
                facility: parseInt(formData.get('facility')),
                staff_attitude: {
                    doctor_label: formData.get('staff_doctor') || null,
                    nurse_label: formData.get('staff_nurse') || null,
                    reception_label: formData.get('staff_reception') || null
                },
                waiting_time: formData.get('waiting_time') || null,
                comment: formData.get('comment') || null
            };
            
            // Validate required ratings
            if (!data.nps && data.nps !== 0) {
                alert('Vui l√≤ng ch·ªçn ƒëi·ªÉm NPS');
                return;
            }
            if (!data.csat && data.csat !== 0) {
                alert('Vui l√≤ng ch·ªçn ƒëi·ªÉm CSAT');
                return;
            }
            if (!data.facility && data.facility !== 0) {
                alert('Vui l√≤ng ch·ªçn ƒëi·ªÉm c∆° s·ªü v·∫≠t ch·∫•t');
                return;
            }
            
            // Show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'ƒêang g·ª≠i...';
            resultDiv.style.display = 'none';
            
            try {
                console.log('üì§ Sending survey data:', data);
                
                const response = await fetch(`${BACKEND_URL}/api/surveys/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('üì• Response:', result);
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ G·ª≠i th√†nh c√¥ng!</strong><br>
                        Survey ID: ${result.data?.surveyId || 'N/A'}<br>
                        ${result.data?.n8nForwarded ? '‚úÖ ƒê√£ g·ª≠i ƒë·∫øn N8N' : '‚ö†Ô∏è Ch∆∞a g·ª≠i ƒë·∫øn N8N'}
                    `;
                    
                    // Reset form
                    e.target.reset();
                    document.querySelectorAll('.rating-btn, .staff-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå L·ªói g·ª≠i kh·∫£o s√°t</strong><br>
                    ${error.message}
                `;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'G·ª≠i kh·∫£o s√°t';
            }
        });
    </script>
</body>
</html>
